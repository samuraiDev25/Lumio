# Интеграция LogOutButton с системой авторизации

## Обзор

Компонент `LogOutButton` реализует функциональность выхода из системы (UC-4) и готов к интеграции с системой авторизации, которую разрабатывают коллеги.

## Требования к системе авторизации

Для корректной работы `LogOutButton` необходимо, чтобы система авторизации сохраняла следующие данные в `localStorage`:

### Обязательные ключи:

1. **`accessToken`** (обязательно)
   - Токен доступа для авторизованных запросов
   - Используется в заголовке `Authorization: Bearer {accessToken}`
   - Должен быть установлен после успешного входа/регистрации

2. **`userEmail`** или **`email`** (опционально, но рекомендуется)
   - Email пользователя для отображения в модалке подтверждения
   - Если не установлен, будет показано "your account"

### Дополнительные ключи (будут очищены при logout):

- `refreshToken` - токен обновления
- `user` - объект пользователя (если используется)
- `userId` - ID пользователя (если используется)

## API Эндпоинт

Компонент использует следующий эндпоинт:

```
POST https://lumio.su/api/v1/auth/logout
Headers:
  Content-Type: application/json
  Authorization: Bearer {accessToken}
```

### Ожидаемые ответы:

- **204** - Успешный выход (токены очищаются, редирект на `/auth/sign-in`)
- **401** - Неавторизован (показывается ошибка из `errorMessages`)
- **500** - Ошибка сервера (показывается ошибка из `errorMessages`)

## Пример интеграции

### После успешного входа/регистрации:

```typescript
// После успешной авторизации
localStorage.setItem('accessToken', response.data.accessToken);
localStorage.setItem('refreshToken', response.data.refreshToken);
localStorage.setItem('userEmail', response.data.user.email);
// или
localStorage.setItem('email', response.data.user.email);
```

### Использование компонента:

```tsx
import { LogOutButton } from '@/features/logout/ui';

// В Header или любом другом месте
<LogOutButton 
  variant="outline"
  onLogout={() => {
    // Дополнительная логика при выходе (опционально)
    // Например, обновление состояния приложения
  }}
/>
```

## Поведение компонента

### Сценарий 1: Успешный выход
1. Пользователь нажимает "Log out"
2. Открывается модалка с подтверждением
3. Пользователь нажимает "Yes"
4. Отправляется запрос на API
5. При успешном ответе (204):
   - Очищаются все токены из localStorage
   - Вызывается колбэк `onLogout` (если передан)
   - Происходит редирект на `/auth/sign-in`

### Сценарий 2: Отмена выхода
1. Пользователь нажимает "Log out"
2. Открывается модалка с подтверждением
3. Пользователь нажимает "No"
4. Показывается сообщение "User with this email doesn't exist"
5. Пользователь нажимает "Close" - модалка закрывается, пользователь остается в системе

### Сценарий 3: Ошибка API
1. Пользователь нажимает "Log out" → "Yes"
2. API возвращает ошибку (401, 500)
3. Показывается сообщение об ошибке из `errorMessages`
4. Пользователь остается в системе

## Важные замечания

1. **Токен обязателен**: Если `accessToken` отсутствует, будет показана ошибка "There is no access token in request"

2. **Очистка данных**: При успешном выходе компонент очищает все ключи, связанные с авторизацией. Если вы добавляете новые ключи, добавьте их очистку в `LogOutButton.tsx` (строка ~101)

3. **Email обновляется**: Email пользователя обновляется при каждом открытии модалки, поэтому если пользователь залогинится после монтирования компонента, email будет корректно отображаться

4. **Защита от множественных кликов**: Компонент защищен от race condition при множественных кликах

5. **Обработка ошибок**: Все ошибки API обрабатываются и отображаются пользователю

## Вопросы для уточнения

Если у вас есть вопросы или нужно добавить дополнительную функциональность, обратитесь к разработчику компонента.

## Совместимость

Компонент готов к работе с:
- ✅ Next.js 16+
- ✅ React 19
- ✅ Любой системой авторизации, которая использует `localStorage` для хранения токенов
- ✅ API эндпоинтом `https://lumio.su/api/v1/auth/logout`

